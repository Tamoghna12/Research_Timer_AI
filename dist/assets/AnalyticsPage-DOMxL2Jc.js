import{r as y,j as e,C as h,a as g,u as O,F as A,b as j}from"./index-Co5BCCHY.js";import{a as H,t as W,s as B,b as P,c as V,d as z,e as _,w as q,f as G,g as J,h as K,i as Q,j as f,k as b}from"./analytics-Cc-YzX2n.js";function k(s,a,r){return H(s,-a,r)}const v=({label:s,value:a,tooltip:r})=>{const[l,o]=y.useState(!1);return e.jsx(h,{className:"relative",children:e.jsx(g,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:s}),e.jsx("p",{className:"text-3xl font-bold text-gray-800 dark:text-gray-200",children:a})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:"ml-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-full p-1",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>o(!0),onBlur:()=>o(!1),"aria-describedby":`tooltip-${s.replace(/\s+/g,"-").toLowerCase()}`,children:[e.jsx("span",{className:"material-icons text-sm",children:"info"}),e.jsxs("span",{className:"sr-only",children:["Show formula for ",s]})]}),l&&e.jsxs("div",{id:`tooltip-${s.replace(/\s+/g,"-").toLowerCase()}`,className:"absolute right-0 top-8 z-10 w-72 p-3 text-xs bg-gray-900 text-white rounded-lg shadow-lg border border-gray-700",role:"tooltip",children:[e.jsx("div",{className:"mb-2 font-medium text-gray-200",children:"Formula:"}),e.jsx("div",{className:"text-gray-300 leading-relaxed",children:r}),e.jsx("div",{className:"absolute -top-1 right-4 w-2 h-2 bg-gray-900 border-l border-t border-gray-700 transform rotate-45"})]})]})]})})})};function U(s){const a=Math.floor(s/60),r=s%60;return`${a}:${r.toString().padStart(2,"0")}`}function X(s){return`${Math.round(s)}%`}function u(s){if(s<60)return`${s}min`;const a=Math.floor(s/60),r=s%60;return r===0?`${a}h`:`${a}h ${r}min`}const C=({data:s,ariaLabel:a})=>{if(s.length===0)return e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No data available"});const r=Math.max(...s.map(l=>l.value));return e.jsxs("div",{role:"img","aria-label":a,className:"space-y-3",children:[e.jsxs("div",{className:"sr-only",children:["Distribution showing ",s.length," items.",s.map((l,o)=>`${l.label}: ${u(l.value)}${o<s.length-1?", ":""}`).join("")]}),s.map((l,o)=>{const c=r>0?l.value/r*100:0;return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-20 text-sm text-gray-600 dark:text-gray-400 text-right flex-shrink-0",children:l.label}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"h-6 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-600 rounded-full transition-all duration-300 ease-out",style:{width:`${c}%`},role:"progressbar","aria-valuenow":l.value,"aria-valuemax":r,"aria-label":`${l.label}: ${u(l.value)}`})}),e.jsx("div",{className:"absolute inset-0 flex items-center px-3",children:e.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:u(l.value)})})]}),e.jsxs("div",{className:"w-12 text-xs text-gray-500 dark:text-gray-400 text-right flex-shrink-0",children:[r>0?Math.round(c):0,"%"]})]},`${l.label}-${o}`)})]})},Y=({matrix:s,rowLabels:a,colLabels:r})=>{if(s.length===0||s[0].length===0)return e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No data available for heatmap"});const l=Math.max(...s.flat()),o=t=>{if(t===0)return"bg-gray-100 dark:bg-gray-800";const i=l>0?t/l:0;return i<=.2?"bg-blue-600/20":i<=.4?"bg-blue-600/40":i<=.6?"bg-blue-600/60":i<=.8?"bg-blue-600/80":"bg-blue-600"},c=s.flat().reduce((t,i)=>t+i,0),p=s.flat().filter(t=>t>0).length;return e.jsxs("div",{role:"img","aria-label":"Weekly focus time heatmap",className:"w-full",children:[e.jsxs("div",{className:"sr-only",children:["Heatmap showing ",r.length," weeks of focus time data. Total focus time: ",u(c)," across ",p," active days. Each cell shows minutes focused on that day."]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Focus time per day"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Less"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gray-100 dark:bg-gray-800"}),e.jsx("div",{className:"w-3 h-3 rounded bg-blue-600/20"}),e.jsx("div",{className:"w-3 h-3 rounded bg-blue-600/40"}),e.jsx("div",{className:"w-3 h-3 rounded bg-blue-600/60"}),e.jsx("div",{className:"w-3 h-3 rounded bg-blue-600/80"}),e.jsx("div",{className:"w-3 h-3 rounded bg-blue-600"})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"More"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"inline-block min-w-full",children:[e.jsxs("div",{className:"flex mb-1",children:[e.jsx("div",{className:"w-12"})," ",r.map((t,i)=>e.jsx("div",{className:"flex-1 min-w-[40px] text-center",children:e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 transform -rotate-45 origin-bottom-left",children:t})},i))]}),s.map((t,i)=>e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx("div",{className:"w-12 text-xs text-gray-500 dark:text-gray-400 text-right pr-2",children:a[i]}),t.map((d,n)=>e.jsx("div",{className:"flex-1 min-w-[40px] px-0.5",children:e.jsx("div",{className:`
                      w-full h-8 rounded border border-gray-200 dark:border-gray-700
                      ${o(d)}
                      flex items-center justify-center cursor-help
                      hover:ring-2 hover:ring-blue-500 hover:ring-opacity-50
                      transition-all duration-200
                    `,title:`${a[i]}, ${r[n]}: ${u(d)}`,role:"gridcell","aria-label":`${a[i]}, ${r[n]}: ${u(d)} focused`,children:e.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:d>0?d:""})})},n))]},i))]})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," ",u(c)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Active days:"})," ",p]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Best day:"})," ",u(l)]})]})]})};function Z(s){const{sessions:a,loading:r,error:l}=O({});return{...y.useMemo(()=>{if(r||l||!a)return{totalFocusTime:0,sessionsCompleted:0,avgSessionLength:0,completionRate:0,modeDistribution:[],tagDistribution:[],heatmapMatrix:[],heatmapRowLabels:[],heatmapColLabels:[],currentStreak:0,longestStreak:0};const c=W(a,s),p=B(a,s),t=P(a,s),i=V(a,s),d=z(a,s),n=Object.entries(d).map(([m,x])=>({label:m,value:x})).sort((m,x)=>x.value-m.value),[M,w]=_(a,s,10),S=Object.entries(M).map(([m,x])=>({label:m,value:x})).sort((m,x)=>x.value-m.value);w>0&&S.push({label:"Other",value:w});const N=6,L=q(a,N),T=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],$=G(new Date,{weekStartsOn:1}),D=Array.from({length:N},(m,x)=>{const E=J($,-(N-1-x));return K(E,"M/d")}),{current:F,longest:R}=Q(a);return{totalFocusTime:c,sessionsCompleted:p,avgSessionLength:t,completionRate:i,modeDistribution:n,tagDistribution:S,heatmapMatrix:L,heatmapRowLabels:T,heatmapColLabels:D,currentStreak:F,longestStreak:R}},[a,s,r,l]),loading:r,error:l}}const te=()=>{const[s,a]=y.useState("last30"),[r,l]=y.useState(""),[o,c]=y.useState(""),p=y.useMemo(()=>{const n=new Date;switch(s){case"last7":return{start:b(k(n,6)),end:f(n)};case"last30":return{start:b(k(n,29)),end:f(n)};case"last90":return{start:b(k(n,89)),end:f(n)};case"custom":return r&&o?{start:b(new Date(r)),end:f(new Date(o))}:void 0;default:return}},[s,r,o]),t=Z(p),i={totalFocusTime:"Total Focus Time = sum of (actual minutes) for completed non-break sessions in range.",sessionsCompleted:"Sessions Completed = count of sessions with status=completed (all modes).",avgSessionLength:"Average Session Length = mean of actual minutes for completed non-break sessions.",completionRate:"Completion Rate = % of completed non-break sessions where actual â‰¥ 90% of planned."},d=n=>{a(n),n!=="custom"&&(l(""),c(""))};return e.jsxs("div",{className:"transition-all duration-300",children:[e.jsxs("div",{className:"text-center space-y-4 p-6 pb-8",children:[e.jsx("h1",{className:"font-display text-4xl lg:text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent drop-shadow-lg",children:"Analytics"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Transparent insights from your research sessions"})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"bg-white/70 dark:bg-gray-900/70 backdrop-blur-lg rounded-xl p-4 border border-gray-200/30 dark:border-gray-700/30",children:e.jsx(A,{label:"Time Range",htmlFor:"range-select",className:"w-auto",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{id:"range-select",value:s,onChange:n=>d(n.target.value),className:"min-w-[140px]",children:[e.jsx("option",{value:"last7",children:"Last 7 days"}),e.jsx("option",{value:"last30",children:"Last 30 days"}),e.jsx("option",{value:"last90",children:"Last 90 days"}),e.jsx("option",{value:"custom",children:"Custom range"})]}),s==="custom"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"date",value:r,onChange:n=>l(n.target.value),className:"w-36","aria-label":"Start date"}),e.jsx("input",{type:"date",value:o,onChange:n=>c(n.target.value),className:"w-36","aria-label":"End date"})]})]})})})}),t.loading&&e.jsx(h,{children:e.jsx(g,{className:"py-8 text-center",children:e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading analytics..."})})}),t.error&&e.jsx(h,{children:e.jsx(g,{className:"py-8 text-center",children:e.jsxs("div",{className:"text-red-600 dark:text-red-400",children:["Error: ",t.error]})})}),!t.loading&&!t.error&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(v,{label:"Total Focus Time",value:U(t.totalFocusTime),tooltip:i.totalFocusTime}),e.jsx(v,{label:"Sessions Completed",value:t.sessionsCompleted,tooltip:i.sessionsCompleted}),e.jsx(v,{label:"Average Session Length",value:`${t.avgSessionLength} min`,tooltip:i.avgSessionLength}),e.jsx(v,{label:"Completion Rate",value:X(t.completionRate),tooltip:i.completionRate})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx("h2",{className:"font-display text-xl font-medium",children:"Focus Time by Mode"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Minutes spent in each focus mode"})]}),e.jsx(g,{children:e.jsx(C,{data:t.modeDistribution,ariaLabel:"Distribution of focus time by session mode"})})]}),e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx("h2",{className:"font-display text-xl font-medium",children:"Focus Time by Tag"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Top tags by focus time",e.jsx("span",{className:"block text-xs mt-1",children:"Note: Full session minutes attributed to each tag"})]})]}),e.jsx(g,{children:e.jsx(C,{data:t.tagDistribution,ariaLabel:"Distribution of focus time by tag"})})]})]}),e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx("h2",{className:"font-display text-xl font-medium",children:"Weekly Focus Heatmap"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Daily focus time over the last 6 weeks (Monday start)"})]}),e.jsx(g,{children:e.jsx(Y,{matrix:t.heatmapMatrix,rowLabels:t.heatmapRowLabels,colLabels:t.heatmapColLabels})})]}),e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx("h2",{className:"font-display text-xl font-medium",children:"Focus Streaks"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Consecutive days with completed focus sessions"})]}),e.jsx(g,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:t.currentStreak}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current streak"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"days in a row"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-secondary mb-2",children:t.longestStreak}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Longest streak"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"personal record"})]})]})})]})]})]})]})};export{te as default};
