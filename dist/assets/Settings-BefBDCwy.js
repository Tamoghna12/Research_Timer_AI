import{r as m,j as e,F as b,B as y,d as p,e as M,f as O,O as L,C as k,b as N,a as w}from"./index-Co5BCCHY.js";import{u as E}from"./useSettings-BOe3EiWx.js";const U=()=>{const{settings:t,saveProfile:a}=E(),[r,d]=m.useState({}),[n,i]=m.useState("");m.useEffect(()=>{t?.researcher&&d(t.researcher)},[t?.researcher]);const o=async(s,x)=>{const h={...r,[s]:x||void 0};d(h);try{await a(h);const v=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});i(`Saved • ${v}`),setTimeout(()=>i(""),3e3)}catch(v){console.error("Failed to save profile:",v),i("Save failed"),setTimeout(()=>i(""),3e3)}},c=s=>{o("name",s.target.value)},l=s=>{o("affiliation",s.target.value)},g=r.name||r.affiliation;return e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{label:"Researcher Name",htmlFor:"researcher-name",children:e.jsx("input",{id:"researcher-name",type:"text",value:r.name||"",onChange:s=>d({...r,name:s.target.value}),onBlur:c,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Dr. Jane Smith"})}),e.jsx(b,{label:"Affiliation",htmlFor:"affiliation",children:e.jsx("input",{id:"affiliation",type:"text",value:r.affiliation||"",onChange:s=>d({...r,affiliation:s.target.value}),onBlur:l,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"University, Lab, or Institution"})}),n&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:n}),g&&e.jsx("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-md",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Weekly Report header:"})," ",e.jsx("span",{className:"font-medium",children:r.name}),r.name&&r.affiliation&&e.jsxs("span",{children:[", ",e.jsx("span",{className:"italic",children:r.affiliation})]}),!r.name&&r.affiliation&&e.jsx("span",{className:"italic",children:r.affiliation})]})})]})};async function R(t){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(t),!0;const a=document.createElement("textarea");a.value=t,a.style.position="fixed",a.style.left="-999999px",a.style.top="-999999px",document.body.appendChild(a),a.focus(),a.select();const r=document.execCommand("copy");return document.body.removeChild(a),r}catch(a){return console.error("Failed to copy to clipboard:",a),!1}}const $=()=>{const{settings:t,savePrivacy:a}=E(),[r,d]=m.useState(""),n=t?.privacy,i=async()=>{if(!n)return;const c={...n,telemetryEnabled:!n.telemetryEnabled};try{await a(c)}catch(l){console.error("Failed to save privacy settings:",l)}},o=async()=>{if(!n?.userAnonId)return;const c=await R(n.userAnonId);d(c?"Copied!":"Copy failed"),setTimeout(()=>d(""),2e3)};return n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:"Anonymous Telemetry"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Help improve Research Timer Pro by sharing anonymous usage data."})]}),e.jsx("div",{className:"ml-4",children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",role:"switch",checked:n.telemetryEnabled,onChange:i,className:"sr-only peer","aria-describedby":"telemetry-description"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-500/20 dark:peer-focus:ring-blue-500/40 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:n.telemetryEnabled?"On":"Off"})]})})]}),n.telemetryEnabled&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Anonymous ID"}),e.jsx("div",{className:"text-xs font-mono text-blue-600 dark:text-blue-300 mt-1 break-all",children:n.userAnonId})]}),e.jsx(y,{variant:"ghost",size:"sm",leftIcon:"content_copy",onClick:o,children:r||"Copy"})]})}),e.jsxs("div",{id:"telemetry-description",className:"space-y-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-md",children:[e.jsx("div",{className:"font-medium mb-2",children:"When telemetry is ON:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[e.jsx("li",{children:"Only anonymous counters are shared (session counts, mode usage)"}),e.jsx("li",{children:"No personal content is ever sent (notes, journals, links, AI summaries)"}),e.jsx("li",{children:"Only your anonymous ID is used to group events"}),e.jsx("li",{children:"Data helps improve the app experience for everyone"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-md",children:[e.jsx("div",{className:"font-medium mb-2",children:"When telemetry is OFF:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[e.jsx("li",{children:"The app makes zero network requests for analytics"}),e.jsx("li",{children:"No usage data is collected or shared"}),e.jsx("li",{children:"Everything stays completely private on your device"})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-md",children:[e.jsx("div",{className:"font-medium mb-2 text-green-800 dark:text-green-200",children:"Your privacy is always protected:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs text-green-700 dark:text-green-300",children:[e.jsx("li",{children:"AI API keys live only in your browser storage"}),e.jsx("li",{children:"All your data stays on your device (IndexedDB)"}),e.jsx("li",{children:"No accounts, logins, or cloud storage required"})]})]})]})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading privacy settings..."})};async function z(){const t=await p.sessions.orderBy("createdAt").toArray(),a=await p.settings.get("app");if(!a)throw new Error("App settings not found - database may be corrupted");return{kind:"research-timer-backup",version:1,createdAt:Date.now(),sessions:t,settings:a}}function G(t){const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),d=document.createElement("a"),n=new Date().toISOString().split("T")[0];d.href=r,d.download=`research-timer-data-${n}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(r)}async function J(t){if(t.kind!=="research-timer-backup")throw new Error("Invalid backup file: not a research timer backup");if(t.version!==1)throw new Error(`Unsupported backup version: ${t.version}. Expected version 1.`);if(!Array.isArray(t.sessions)||!t.settings)throw new Error("Invalid backup file: missing sessions or settings data");const a=await p.sessions.toArray(),r=new Map(a.map(o=>[o.id,o]));let d=0,n=0,i=0;for(const o of t.sessions){const c=r.get(o.id);c?o.updatedAt>c.updatedAt?n++:i++:d++}return{sessionsToAdd:d,sessionsToUpdate:n,sessionsSkipped:i}}async function _(t,a){if(t.kind!=="research-timer-backup"||t.version!==1)throw new Error("Invalid backup file");const r=await p.sessions.toArray(),d=new Map(r.map(c=>[c.id,c]));let n=0,i=0,o=0;return await p.transaction("rw",[p.sessions,p.settings],async()=>{for(const l of t.sessions){const g=d.get(l.id);g?l.updatedAt>g.updatedAt?(await p.sessions.put(l),i++):o++:(await p.sessions.add(l),n++)}const c=await p.settings.get("app");if(!c||t.settings.updatedAt>c.updatedAt){const l={...t.settings,privacy:c?.privacy||t.settings.privacy,ai:c?.ai||t.settings.ai,updatedAt:Date.now()};await p.settings.put(l)}}),{added:n,updated:i,skipped:o}}const q=({open:t,onConfirm:a,onCancel:r})=>{const[d,n]=m.useState(""),i=d==="DELETE",o=()=>{i&&a()},c=l=>{l.key==="Escape"?r():l.key==="Enter"&&i&&o()};return t?M.createPortal(e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-full items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-md transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 shadow-xl transition-all",role:"dialog","aria-modal":"true","aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-warning",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-300 dark:border-gray-600",children:e.jsx("h3",{id:"delete-modal-title",className:"text-lg font-medium text-red-600 dark:text-red-400",children:"Delete All Data"})}),e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{id:"delete-modal-warning",className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("div",{className:"font-medium text-red-600 dark:text-red-400 mb-2",children:"⚠️ This action cannot be undone"}),e.jsx("p",{className:"mb-4",children:"This will permanently delete all your research sessions, journal entries, AI summaries, settings, and all other data. Everything will be lost forever."}),e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:"Before continuing:"}),' Consider exporting your data as a backup using the "Export All Data" button above.']})]}),e.jsx(b,{label:"Type DELETE to confirm",htmlFor:"confirm-delete",hint:"This confirms you understand the data will be permanently lost",children:e.jsx("input",{id:"confirm-delete",type:"text",value:d,onChange:l=>n(l.target.value),onKeyDown:c,className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent ${d&&!i?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"}`,placeholder:"DELETE",autoComplete:"off",autoFocus:!0,"aria-describedby":"delete-modal-warning"})}),d&&!i&&e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:'Please type "DELETE" exactly to confirm'})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-800/50 border-t border-gray-300 dark:border-gray-600",children:[e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 sm:justify-end",children:[e.jsx(y,{variant:"ghost",onClick:r,children:"Cancel"}),e.jsx(y,{variant:"danger",onClick:o,disabled:!i,leftIcon:"delete_forever",children:"Delete All Data"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Press Esc to cancel"})]})]})]})}),document.body):null},K=()=>{const t=m.useRef(null),[a,r]=m.useState(!1),[d,n]=m.useState(null),[i,o]=m.useState(null),[c,l]=m.useState(!1),[g,s]=m.useState(""),[x,h]=m.useState(!1),[v,u]=m.useState(""),C=f=>{u(f),setTimeout(()=>u(""),5e3)},P=async()=>{r(!0);try{const f=await z();G(f),C(`Exported ${f.sessions.length} sessions successfully`)}catch(f){console.error("Export failed:",f),C("Export failed. Please try again.")}finally{r(!1)}},F=async f=>{const S=f.target.files?.[0];if(S){s(""),n(null),o(null);try{const A=await S.text(),I=JSON.parse(A),B=await J(I);n(I),o(B)}catch(A){const I=A instanceof Error?A.message:"Invalid backup file";s(I),console.error("Import preview failed:",A)}}},D=async()=>{if(!(!d||!i)){l(!0);try{const f=await _(d,i);C(`Import complete: ${f.added} added, ${f.updated} updated, ${f.skipped} skipped`),n(null),o(null),s(""),t.current&&(t.current.value="")}catch(f){const S=f instanceof Error?f.message:"Import failed";s(S),console.error("Import failed:",f)}finally{l(!1)}}},T=async()=>{try{await p.transaction("rw",[p.sessions,p.settings],async()=>{await p.sessions.clear(),await p.settings.clear()}),h(!1),window.location.reload()}catch(f){console.error("Delete all failed:",f),C("Failed to delete data. Please try again.")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800 dark:text-gray-200 mb-2",children:"Export Data"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Download all your research sessions, settings, and AI summaries as a JSON backup file."}),e.jsx(y,{variant:"secondary",leftIcon:"download",onClick:P,disabled:a,children:a?"Exporting...":"Export All Data"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800 dark:text-gray-200 mb-2",children:"Import Data"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Restore data from a Research Timer Pro backup file. Existing data will be merged intelligently."}),e.jsx(b,{label:"Backup File",htmlFor:"import-file",children:e.jsx("input",{ref:t,id:"import-file",type:"file",accept:".json",onChange:F,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-600 file:text-white hover:file:bg-blue-600/90"})}),g&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsxs("div",{className:"text-sm text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"Import Error:"})," ",g]})}),i&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-md",children:[e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-200 mb-3",children:e.jsx("strong",{children:"Import Preview:"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-green-700 dark:text-green-300",children:i.sessionsToAdd}),e.jsx("div",{className:"text-green-600 dark:text-green-400",children:"New Sessions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-blue-700 dark:text-blue-300",children:i.sessionsToUpdate}),e.jsx("div",{className:"text-blue-600 dark:text-blue-400",children:"Updates"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-700 dark:text-gray-300",children:i.sessionsSkipped}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Skipped"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(y,{variant:"primary",leftIcon:"merge",onClick:D,disabled:c,children:c?"Importing...":"Merge Data"})}),e.jsx("div",{className:"mt-2 text-xs text-blue-600 dark:text-blue-400",children:"Sessions are merged by ID. Newer versions (by updatedAt) will replace older ones. Your privacy settings and AI configuration will be preserved."})]})]}),e.jsxs("div",{className:"border-t border-gray-300 dark:border-gray-600 pt-6",children:[e.jsx("h3",{className:"font-medium text-red-600 dark:text-red-400 mb-2",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Permanently delete all your sessions, settings, and data. This action cannot be undone. Consider exporting your data first."}),e.jsx(y,{variant:"danger",leftIcon:"delete_forever",onClick:()=>h(!0),"aria-describedby":"delete-warning",children:"Delete All Data"}),e.jsx("div",{id:"delete-warning",className:"sr-only",children:"This will permanently delete all your research data and cannot be undone"})]}),e.jsx(q,{open:x,onConfirm:T,onCancel:()=>h(!1)}),v&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsx("div",{className:"bg-green-600 text-white px-4 py-2 rounded-md shadow-lg",children:v})})]})},W=()=>{const[t,a]=m.useState("idle"),[r,d]=m.useState(null),{settings:n,saveAi:i}=E(),{testConnection:o}=O(),c=m.useCallback(async u=>{const C=n?.ai||{enabled:!1,provider:"openai",model:"gpt-4o-mini",bullets:5,maxChars:300,temperature:.2,includeJournal:!0};await i({...C,...u})},[n?.ai,i]),l=m.useCallback(async()=>{a("testing"),d(null);const u=await o();a(u.ok?"success":"error"),d(u.message||null)},[o]),g={enabled:!1,provider:"openai",model:"gpt-4o-mini",bullets:5,maxChars:300,temperature:.2,includeJournal:!0},s=n?.ai||g,x=[{value:"openai",label:"OpenAI",description:"GPT models via OpenAI API"},{value:"anthropic",label:"Anthropic",description:"Claude models via Anthropic API"},{value:"gemini",label:"Google Gemini",description:"Gemini models via Google AI API"},{value:"groq",label:"Groq",description:"Ultra-fast inference with Llama, Mixtral, and Gemma models"}],h=u=>{switch(u){case"openai":return"gpt-4o-mini";case"anthropic":return"claude-3-haiku-20240307";case"gemini":return"gemini-1.5-pro";case"groq":return"llama-3.1-70b-versatile";default:return""}},v=u=>{switch(u){case"openai":return"Available models: gpt-4o, gpt-4o-mini, gpt-4-turbo, gpt-3.5-turbo";case"anthropic":return"Available models: claude-3-5-sonnet-20241022, claude-3-opus-20240229, claude-3-haiku-20240307";case"gemini":return"Available models: gemini-1.5-pro, gemini-1.5-flash, gemini-pro";case"groq":return"Available models: llama-3.1-70b-versatile, llama-3.1-8b-instant, llama3-70b-8192, llama3-8b-8192, mixtral-8x7b-32768, gemma-7b-it, gemma2-9b-it";default:return"The AI model to use for summarization"}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:"Enable AI Summarization (opt-in)"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Generate concise summaries of your research sessions using AI. All settings are stored locally."})]}),e.jsx("div",{className:"ml-4",children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:u=>c({enabled:u.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-500/20 dark:peer-focus:ring-blue-500/40 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})})]}),s.enabled&&e.jsxs("div",{className:"mt-6 space-y-6 border-t border-gray-300 dark:border-gray-600 pt-6",children:[e.jsxs(b,{label:"AI Provider",htmlFor:"provider",children:[e.jsx("select",{id:"provider",value:s.provider||"ollama",onChange:u=>c({provider:u.target.value,model:h(u.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:x.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))}),e.jsx("div",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:x.find(u=>u.value===s.provider)?.description})]}),e.jsx(b,{label:"Model",htmlFor:"model",hint:v(s.provider||"openai"),children:e.jsx("input",{id:"model",type:"text",value:s.model||"",onChange:u=>c({model:u.target.value}),onBlur:()=>{},placeholder:h(s.provider||"openai"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),e.jsx(b,{label:"API Key",htmlFor:"apiKey",hint:"Your API key will be stored locally and never shared",children:e.jsx("input",{id:"apiKey",type:"password",value:s.apiKey||"",onChange:u=>c({apiKey:u.target.value}),onBlur:()=>{},placeholder:"Enter your API key",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-300 dark:border-gray-600",children:[e.jsx("h3",{className:"font-medium text-gray-800 dark:text-gray-200",children:"Advanced Settings"}),e.jsx(b,{label:`Summary Bullets: ${s.bullets}`,htmlFor:"bullets",hint:"Number of bullet points in the summary (3-7)",children:e.jsx("input",{id:"bullets",type:"range",min:"3",max:"7",step:"1",value:s.bullets||5,onChange:u=>c({bullets:parseInt(u.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"})}),e.jsx(b,{label:`Max Characters: ${s.maxChars}`,htmlFor:"maxChars",hint:"Maximum length of the summary (150-600 characters)",children:e.jsx("input",{id:"maxChars",type:"range",min:"150",max:"600",step:"50",value:s.maxChars||300,onChange:u=>c({maxChars:parseInt(u.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"})}),e.jsx(b,{label:`Creativity: ${s.temperature?.toFixed(1)}`,htmlFor:"temperature",hint:"Higher values make output more creative, lower values more focused (0.0-1.0)",children:e.jsx("input",{id:"temperature",type:"range",min:"0",max:"1",step:"0.1",value:s.temperature||.2,onChange:u=>c({temperature:parseFloat(u.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:"Include Journal"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Include journal entries in the summary (recommended)"})]}),e.jsx("div",{className:"ml-4",children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.includeJournal??!0,onChange:u=>c({includeJournal:u.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-500/20 dark:peer-focus:ring-blue-500/40 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-300 dark:border-gray-600",children:[e.jsx(y,{onClick:l,disabled:t==="testing",leftIcon:t==="testing"?"hourglass_empty":t==="success"?"check_circle":t==="error"?"error":"wifi",variant:t==="error"?"danger":"secondary",children:t==="testing"?"Testing Connection...":"Test Connection"}),r&&e.jsx("div",{className:`mt-2 p-3 rounded-md text-sm ${t==="success"?"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200":"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200"}`,children:r})]})]})]})},H=()=>{const[t,a]=m.useState(null),[r,d]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const g=await p.musicPreferences.get("music");a(g||null)}catch(g){console.error("Failed to load music preferences:",g)}finally{d(!1)}})()},[]);const n=async l=>{if(t)try{const g={...t,...l,updatedAt:Date.now()};await p.musicPreferences.put(g),a(g)}catch(g){console.error("Failed to update music preferences:",g)}},i=()=>{n({enabled:!t?.enabled})},o=l=>{n({source:l})},c=()=>{n({localFile:void 0})};return r?e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading music settings..."}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Focus Music"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Enable music during focus sessions"})]}),e.jsx(y,{onClick:i,variant:t.enabled?"primary":"secondary",size:"sm",children:t.enabled?"Enabled":"Disabled"})]}),t.enabled&&e.jsxs(e.Fragment,{children:[e.jsx(b,{label:"Preferred Music Source",htmlFor:"music-source",children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["youtube","spotify","local"].map(l=>e.jsx("button",{onClick:()=>o(l),className:`p-3 rounded-lg border text-center capitalize transition-colors ${t.source===l?"border-blue-600 bg-blue-600/10 text-blue-600":"border-gray-200 dark:border-gray-700 hover:border-blue-600/50"}`,children:e.jsx("div",{className:"text-sm font-medium",children:l})},l))})}),e.jsxs("div",{className:"space-y-3",children:[t.youtubeUrl&&e.jsx(b,{label:"Saved YouTube URL",htmlFor:"saved-youtube",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"saved-youtube",value:t.youtubeUrl,readOnly:!0,className:"flex-1 text-sm"}),e.jsx(y,{onClick:()=>n({youtubeUrl:void 0}),variant:"ghost",size:"sm",leftIcon:"delete",children:"Clear"})]})}),t.spotifyUrl&&e.jsx(b,{label:"Saved Spotify URL",htmlFor:"saved-spotify",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"saved-spotify",value:t.spotifyUrl,readOnly:!0,className:"flex-1 text-sm"}),e.jsx(y,{onClick:()=>n({spotifyUrl:void 0}),variant:"ghost",size:"sm",leftIcon:"delete",children:"Clear"})]})}),t.localFile&&e.jsx(b,{label:"Local Audio File",htmlFor:"saved-local",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"flex-1 text-sm text-gray-600 dark:text-gray-400",children:t.localFile}),e.jsx(y,{onClick:c,variant:"ghost",size:"sm",leftIcon:"delete",children:"Clear"})]})})]}),e.jsx(b,{label:`Volume: ${t.volume}%`,htmlFor:"volume",children:e.jsx("input",{id:"volume",type:"range",min:"0",max:"100",value:t.volume,onChange:l=>n({volume:Number(l.target.value)}),className:"w-full"})})]})]}):e.jsx("div",{className:"text-red-500 dark:text-red-400",children:"Failed to load music preferences"})},j=[{id:"forest",name:"Forest Canopy",type:"gradient",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{id:"ocean",name:"Ocean Depth",type:"gradient",gradient:"linear-gradient(135deg, #667db6 0%, #0082c8 100%)"},{id:"sunset",name:"Sunset Sky",type:"gradient",gradient:"linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%)"},{id:"mountain",name:"Mountain Vista",type:"gradient",gradient:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"},{id:"space",name:"Deep Space",type:"gradient",gradient:"linear-gradient(135deg, #434343 0%, #000000 100%)"}],Y=()=>{const[t,a]=m.useState(null),[r,d]=m.useState(null),[,n]=m.useState(0);m.useEffect(()=>{(async()=>{try{const x=await p.userPreferences.get("user");if(x&&(d(x),x.backgroundsEnabled))if(x.background.staticImage){const h=j.find(v=>v.id===x.background.staticImage);a(h||j[0])}else a(j[0])}catch(x){console.error("Failed to load background preferences:",x)}})()},[]),m.useEffect(()=>{if(!r?.backgroundsEnabled||!r.background.autoChange||r.background.staticImage)return;const s=r.background.interval*60*1e3,x=window.setInterval(()=>{n(h=>{const v=(h+1)%j.length;return a(j[v]),v})},s);return()=>window.clearInterval(x)},[r]);const i=m.useCallback(async s=>{try{const x=await p.userPreferences.get("user");if(x){const h={...x,...s,updatedAt:Date.now()};await p.userPreferences.put(h),d(h)}}catch(x){console.error("Failed to update background preferences:",x)}},[]),o=m.useCallback(async s=>{if(r&&(await i({background:{...r.background,staticImage:s??void 0}}),s)){const x=j.find(h=>h.id===s);x&&a(x)}},[r,i]),c=m.useCallback(async s=>{r&&await i({background:{...r.background,autoChange:s}})},[r,i]),l=m.useCallback(async s=>{r&&await i({background:{...r.background,interval:s}})},[r,i]),g=m.useCallback(async s=>{await i({backgroundsEnabled:s}),a(s?j[0]:null)},[i]);return{currentBackground:t,backgrounds:j,preferences:r,setStaticBackground:o,toggleAutoChange:c,setInterval:l,toggleBackgrounds:g}},V=()=>{const{preferences:t,backgrounds:a,toggleBackgrounds:r,toggleAutoChange:d,setInterval:n,setStaticBackground:i}=Y();return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Dynamic Backgrounds"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Beautiful, changing backgrounds for better focus"})]}),e.jsx(y,{onClick:()=>r(!t.backgroundsEnabled),variant:t.backgroundsEnabled?"primary":"secondary",size:"sm",children:t.backgroundsEnabled?"Enabled":"Disabled"})]}),t.backgroundsEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Auto-change Backgrounds"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Automatically rotate through backgrounds"})]}),e.jsx(y,{onClick:()=>d(!t.background.autoChange),variant:t.background.autoChange?"primary":"secondary",size:"sm",children:t.background.autoChange?"On":"Off"})]}),t.background.autoChange&&e.jsxs(b,{label:`Change interval: ${t.background.interval} minutes`,htmlFor:"interval",children:[e.jsx("input",{id:"interval",type:"range",min:"5",max:"60",step:"5",value:t.background.interval,onChange:o=>n(Number(o.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("span",{children:"5 min"}),e.jsx("span",{children:"60 min"})]})]}),!t.background.autoChange&&e.jsx(b,{label:"Choose Static Background",htmlFor:"static-bg",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:a.map(o=>e.jsxs("button",{onClick:()=>i(o.id),className:`p-3 rounded-lg border text-left transition-colors ${t.background.staticImage===o.id?"border-blue-600 bg-blue-600/10":"border-gray-200 dark:border-gray-700 hover:border-blue-600/50"}`,style:{background:o.gradient,position:"relative"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 rounded-lg"}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"font-medium text-white text-sm",children:o.name})})]},o.id))})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Available Backgrounds"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:a.map(o=>e.jsx("div",{className:"aspect-square rounded-lg",style:{background:o.gradient},title:o.name},o.id))})]})]})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading background settings..."})},Q=()=>{const[t,a]=m.useState(!1),[r,d]=m.useState(null),[n,i]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const g=await p.userPreferences.get("user");d(g||null)}catch(g){console.error("Failed to load user preferences:",g)}finally{i(!1)}})()},[]);const o=async()=>{if(r)try{const l={...r,onboardingCompleted:!1,updatedAt:Date.now()};await p.userPreferences.put(l),d(l),a(!0)}catch(l){console.error("Failed to reset onboarding:",l)}},c=async()=>{a(!1);try{const l=await p.userPreferences.get("user");d(l||null)}catch(l){console.error("Failed to reload preferences:",l)}};return n?e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading onboarding settings..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Onboarding"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r?.onboardingCompleted?"Welcome setup completed":"Welcome setup not completed"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:r?.onboardingCompleted&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx("span",{className:"material-icons text-xs mr-1",children:"check_circle"}),"Completed"]})})]}),r?.onboardingCompleted&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Current Preferences"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"material-icons text-blue-600 text-sm",children:"schedule"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Focus Mode: ",r.focusMode?r.focusMode.charAt(0).toUpperCase()+r.focusMode.slice(1):"None"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"material-icons text-blue-600 text-sm",children:"library_music"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Music: ",r.musicEnabled?(r.musicSource||"Enabled").charAt(0).toUpperCase()+(r.musicSource||"Enabled").slice(1):"Disabled"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"material-icons text-blue-600 text-sm",children:"landscape"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Backgrounds: ",r.backgroundsEnabled?"Enabled":"Disabled"]})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsx(y,{onClick:o,variant:"primary",leftIcon:"refresh",children:"Restart Onboarding Questions"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"This will walk you through the initial setup questions again and allow you to update your preferences."})]})]}),e.jsx(L,{isOpen:t,onComplete:c})]})},ee=()=>e.jsxs("div",{className:"transition-all duration-300",children:[e.jsxs("div",{className:"text-center space-y-4 p-6 pb-8",children:[e.jsx("h1",{className:"font-display text-4xl lg:text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent drop-shadow-lg",children:"Settings"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Customize your Research Timer Pro experience and manage your data"})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 space-y-6",children:[e.jsxs(k,{children:[e.jsx(N,{children:e.jsx("h2",{className:"font-display text-xl font-medium bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Profile"})}),e.jsx(w,{children:e.jsx(U,{})})]}),e.jsxs(k,{children:[e.jsx(N,{children:e.jsx("h2",{className:"font-display text-xl font-medium bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Privacy"})}),e.jsx(w,{children:e.jsx($,{})})]}),e.jsxs(k,{children:[e.jsx(N,{children:e.jsx("h2",{className:"font-display text-xl font-medium bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Data"})}),e.jsx(w,{children:e.jsx(K,{})})]}),e.jsxs(k,{children:[e.jsx(N,{children:e.jsx("h2",{className:"font-display text-xl font-medium bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"AI Features"})}),e.jsx(w,{children:e.jsx(W,{})})]}),e.jsxs(k,{children:[e.jsx(N,{children:e.jsx("h2",{className:"font-display text-xl font-medium bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Music Preferences"})}),e.jsx(w,{children:e.jsx(H,{})})]}),e.jsxs(k,{children:[e.jsx(N,{children:e.jsx("h2",{className:"font-display text-xl font-medium bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Background Preferences"})}),e.jsx(w,{children:e.jsx(V,{})})]}),e.jsxs(k,{children:[e.jsx(N,{children:e.jsx("h2",{className:"font-display text-xl font-medium bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Onboarding"})}),e.jsx(w,{children:e.jsx(Q,{})})]})]})]});export{ee as default};
